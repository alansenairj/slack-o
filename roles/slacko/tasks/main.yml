---
# tasks file for slacko

  - name: Clone a repo with separate git directory
    ansible.builtin.git:
      repo: https://github.com/LeonardoDG2084/iaac_slacko-api
      dest: /opt/slacko-api/
    tags:
      - gitclone

  - name: Instalaçao do MongoDB
    apt: 
      name: mongodb
      state: present
      update_cache: yes
    tags:
        - mongodb
    notify:
        - restart mongodb

  - name: Instalaço dos requerimentos do Python
    pip:
      requirements: /opt/slacko-api/requeriments.txt
    tags: 
      - python

  - name: Criar o diretório pela variável do path
    file:
        path: "{{ path }}"

  - name: Copiar o script .sh
    copy:
        src: slacko-api.sh
        dest: "{{  path  }}"
        owner: root
        group: root
    tags: 
      - script

  - name: Copiar arquivo que transforma script em service
    copy:
      src: slacko-api.service
      dest: /etc/systemd/system
      owner: root
      group: root
    notify:
      - copy.service
    tags: 
      - copy.service
 
  #- name: Reiniciar o sytemctl daemon
  #  command: systemctl daemon-reload
  #  tags:
  #    - sysctl
